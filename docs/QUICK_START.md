# é£ä¹¦ MCP æœåŠ¡å™¨ - å¿«é€Ÿæ“ä½œæŒ‡å—

## ğŸ“‹ é…ç½®æ¦‚è§ˆ

| é¡¹ç›® | å€¼ |
|------|-----|
| åº”ç”¨ ID | `cli_a9e9d88712f89cc6` |
| MCP ç›®å½• | `c:\Users\Administrator\.claude\feishu-enterprise-mcp\` |
| Token æ–‡ä»¶ | `user_token.json` |
| è®¤è¯æœåŠ¡å™¨ | `auth_server.js` |
| æ•…éšœæ’æŸ¥æŒ‡å— | [TROUBLESHOOTING.md](TROUBLESHOOTING.md) |

---

## ğŸš€ æ­£å¸¸ä½¿ç”¨ï¼ˆå·²æˆæƒå®Œæˆï¼‰

ç›´æ¥åœ¨ Claude Code ä¸­ä½¿ç”¨é£ä¹¦åŠŸèƒ½ï¼š

```
# åˆ›å»º Wiki çŸ¥è¯†åº“
"åˆ›å»ºä¸€ä¸ªåä¸º 'æˆ‘çš„é¡¹ç›®ç¬”è®°' çš„ Wiki çŸ¥è¯†åº“"

# åˆ›å»ºæ–‡æ¡£
"åœ¨é£ä¹¦åˆ›å»ºä¸€ä¸ªæ–‡æ¡£ï¼Œæ ‡é¢˜æ˜¯ 'ä¼šè®®è®°å½•'ï¼Œå†…å®¹æ˜¯ 'ä»Šå¤©è®¨è®ºäº†...'"

# æœç´¢æ–‡ä»¶
"åœ¨é£ä¹¦æœç´¢åŒ…å« 'åˆåŒ' çš„æ–‡ä»¶"

# åˆ›å»ºæ—¥å†äº‹ä»¶
"åˆ›å»ºæ˜å¤©ä¸‹åˆ2ç‚¹çš„æ—¥å†äº‹ä»¶"
```

---

## ğŸ”„ Token åˆ·æ–°æœºåˆ¶

| çŠ¶æ€ | å¤„ç†æ–¹å¼ |
|------|---------|
| Token æœªè¿‡æœŸï¼ˆ2å°æ—¶å†…ï¼‰| ç›´æ¥ä½¿ç”¨ç¼“å­˜ |
| Token å·²è¿‡æœŸ | è‡ªåŠ¨ä½¿ç”¨ refresh_token åˆ·æ–° |
| refresh_token å¤±æ•ˆ | éœ€è¦é‡æ–°æˆæƒ |

**æœ‰æ•ˆæœŸè¯´æ˜**ï¼š
- `access_token`: 2 å°æ—¶
- `refresh_token`: 30 å¤©

---

## âš ï¸ æ•…éšœæ’æŸ¥

> ğŸ“Œ **è¯¦ç»†æ•…éšœæ’æŸ¥æŒ‡å—**: æŸ¥çœ‹ [TROUBLESHOOTING.md](TROUBLESHOOTING.md)

### ä¸€é”®è¯Šæ–­ï¼ˆæ¨èé¦–é€‰ï¼‰

é‡åˆ°é—®é¢˜æ—¶ï¼Œé¦–å…ˆè¿è¡Œè¯Šæ–­è„šæœ¬ï¼š

```bash
cd c:\Users\Administrator\.claude\feishu-enterprise-mcp
c:/Windows/System32/WindowsPowerShell/v1.0/powershell.exe -ExecutionPolicy Bypass -File scripts/diagnose.ps1
```

### é—®é¢˜é€ŸæŸ¥è¡¨

| ç—‡çŠ¶ | å¿«é€Ÿè§£å†³ |
|------|----------|
| `localhost:3000` æ— æ³•è®¿é—® | `node auth_server.js` |
| MCP è¿”å›ç©ºç»“æœ | é‡å¯ Claude Code |
| é”™è¯¯ç  99991679 | æ£€æŸ¥æƒé™ â†’ é‡æ–°æˆæƒ |
| ERR_CONNECTION_REFUSED | å¯åŠ¨æˆæƒæœåŠ¡å™¨ |

### é—®é¢˜ 1: "é”™è¯¯ç  99991679 - åº”ç”¨æœªè·å–æ‰€éœ€çš„ç”¨æˆ·æˆæƒ"

**åŸå› **: Token ç¼ºå°‘å¿…è¦çš„æƒé™èŒƒå›´

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. åˆ é™¤æ—§ token
cd c:\Users\Administrator\.claude\feishu-enterprise-mcp
rm user_token.json

# 2. é‡æ–°æˆæƒ
node auth_server.js

# 3. æµè§ˆå™¨è®¿é—® http://localhost:3000 å®Œæˆæˆæƒ
```

### é—®é¢˜ 2: "æˆæƒé“¾æ¥é”™è¯¯ (ERR_CONNECTION_REFUSED)"

**åŸå› **: è®¤è¯æœåŠ¡å™¨æœªè¿è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
```bash
cd c:\Users\Administrator\.claude\feishu-enterprise-mcp
node auth_server.js
```

### é—®é¢˜ 3: MCP å‡½æ•°è¿”å›ç©ºç»“æœ

**åŸå› **: MCP æœåŠ¡å™¨æœªä½¿ç”¨ user tokenï¼ˆä»£ç å·²ä¿®å¤ï¼Œéœ€é‡å¯ï¼‰

**è§£å†³æ–¹æ¡ˆ**: é‡å¯ Claude Code

### é—®é¢˜ 4: TUN æ¨¡å¼å¯¼è‡´æˆæƒå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**: åœ¨ä»£ç†è½¯ä»¶ä¸­æ·»åŠ ç»•è¿‡è§„åˆ™
```
localhost
127.0.0.1
```

### é—®é¢˜ 5: Wiki åˆ›å»ºå¤±è´¥

**æ£€æŸ¥æ¸…å•**:
- [ ] å·²åœ¨é£ä¹¦å¼€æ”¾å¹³å°é…ç½® Wiki æƒé™
  - `wiki:wiki`
  - `wiki:space:write_only`
  - `wiki:space:read`
- [ ] å·²é‡æ–°æˆæƒï¼ˆscope åŒ…å« Wiki æƒé™ï¼‰
- [ ] Token æœªè¿‡æœŸ

---

## ğŸ“ é‡æ–°æˆæƒæ­¥éª¤ï¼ˆå®Œæ•´ç‰ˆï¼‰

å½“éœ€è¦é‡æ–°æˆæƒæ—¶ï¼š

```bash
# 1. è¿›å…¥ç›®å½•
cd c:\Users\Administrator\.claude\feishu-enterprise-mcp

# 2. åˆ é™¤æ—§ tokenï¼ˆå¯é€‰ï¼‰
rm user_token.json

# 3. å¯åŠ¨è®¤è¯æœåŠ¡å™¨
node auth_server.js

# 4. æµè§ˆå™¨è®¿é—®
http://localhost:3000

# 5. ç‚¹å‡»ã€Œæ‰“å¼€æˆæƒé¡µé¢ã€

# 6. åœ¨é£ä¹¦é¡µé¢å‹¾é€‰æ‰€æœ‰æƒé™å¹¶åŒæ„

# 7. å®Œæˆåå¯å…³é—­æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
```

---

## ğŸ› ï¸ æ‰‹åŠ¨æµ‹è¯•å‘½ä»¤

### è¿è¡Œè¯Šæ–­è„šæœ¬
```bash
cd c:\Users\Administrator\.claude\feishu-enterprise-mcp
c:/Windows/System32/WindowsPowerShell/v1.0/powershell.exe -ExecutionPolicy Bypass -File scripts/diagnose.ps1
```

### æŸ¥çœ‹ Token ä¿¡æ¯
```bash
cd c:\Users\Administrator\.claude\feishu-enterprise-mcp
cat user_token.json
```

### æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸ
```bash
# åœ¨ Node.js ä¸­è¿è¡Œ
node -e "const t=JSON.parse(fs.readFileSync('user_token.json')); console.log('å‰©ä½™ç§’æ•°:', Math.floor(t.expires_at-Date.now()/1000))"
```

---

## ğŸ“Œ æƒé™é…ç½®æ¸…å•

åœ¨é£ä¹¦å¼€æ”¾å¹³å°éœ€è¦é…ç½®çš„æƒé™ï¼š

| æƒé™ | ç”¨é€” |
|------|------|
| `wiki:wiki` | æŸ¥çœ‹ã€ç¼–è¾‘çŸ¥è¯†åº“ |
| `wiki:space:write_only` | åˆ›å»ºçŸ¥è¯†åº“ |
| `wiki:space:read` | è¯»å–çŸ¥è¯†åº“ |
| `drive:drive` | äº‘ç›˜è®¿é—® |
| `drive:file:read` | è¯»å–æ–‡ä»¶ |
| `drive:file:write` | å†™å…¥æ–‡ä»¶ |
| `docx:document` | æ–‡æ¡£æ“ä½œ |
| `bitable:app` | å¤šç»´è¡¨æ ¼ |
| `calendar:calendar` | æ—¥å†æ“ä½œ |
| `email:user` | ç”¨æˆ·ä¿¡æ¯ |

**é…ç½®è·¯å¾„**:
[é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/app) â†’ åº”ç”¨ â†’ æƒé™ç®¡ç† â†’ æƒé™é›†

---

## ğŸ¯ å¸¸ç”¨åŠŸèƒ½ç¤ºä¾‹

### Wiki æ“ä½œ
```
åˆ›å»º Wiki çŸ¥è¯†åº“
"åˆ›å»ºä¸€ä¸ªåä¸º 'é¡¹ç›®æ–‡æ¡£' çš„ Wiki"
```

### æ–‡æ¡£æ“ä½œ
```
åˆ›å»ºæ–‡æ¡£
"åˆ›å»ºæ–‡æ¡£ 'å‘¨æŠ¥'ï¼Œå†…å®¹æ˜¯ 'æœ¬å‘¨å®Œæˆäº†...'"
```

### å¤šç»´è¡¨æ ¼
```
åˆ›å»ºå¤šç»´è¡¨æ ¼
"åˆ›å»ºä¸€ä¸ªåä¸º 'ä»»åŠ¡è·Ÿè¸ª' çš„å¤šç»´è¡¨æ ¼"
```

### æ—¥å†
```
åˆ›å»ºæ—¥ç¨‹
"åˆ›å»ºæ˜å¤©ä¸Šåˆ10ç‚¹çš„ä¼šè®®æé†’"
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å®šæœŸæ£€æŸ¥ Token æœ‰æ•ˆæœŸ** - Token æ¯ 2 å°æ—¶è¿‡æœŸï¼Œä½†ä¼šè‡ªåŠ¨åˆ·æ–°
2. **ä¿å­˜ refresh_token** - 30 å¤©æœ‰æ•ˆï¼Œç”¨äºè‡ªåŠ¨åˆ·æ–°
3. **æƒé™é…ç½®å®Œæ•´** - ä¸€æ¬¡æ€§é…ç½®æ‰€æœ‰éœ€è¦çš„æƒé™
4. **æˆæƒåå¯å…³é—­è®¤è¯æœåŠ¡å™¨** - ä¸éœ€è¦æŒç»­è¿è¡Œ

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **é¦–å…ˆè¿è¡Œè¯Šæ–­è„šæœ¬**: `scripts/diagnose.ps1`
2. æŸ¥çœ‹è¯¦ç»†æ•…éšœæ’æŸ¥æŒ‡å—: [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
3. æ£€æŸ¥é£ä¹¦å¼€æ”¾å¹³å°æƒé™æ˜¯å¦å·²é…ç½®
4. ç¡®è®¤ `user_token.json` æ–‡ä»¶æ˜¯å¦å­˜åœ¨

---

**æœ€åæ›´æ–°**: 2026-01-11
**ç‰ˆæœ¬**: 1.1
